{"version":3,"sources":["assets\\Script\\game\\rocker.js"],"names":["TagOfDirection","cc","Enum","up","right","down","left","no","Class","Component","properties","playerNodeSpeed","Max_r","onLoad","rockerBg","node","getChildByName","joystick","setPosition","v2","dir","parent","on","Node","EventType","TOUCH_START","cbTouchStart","TOUCH_MOVE","cbTouchMove","TOUCH_END","cbTouchEnd","TOUCH_CANCEL","cbTouchCancel","update","dt","mag","r","Math","atan2","y","x","degree","PI","vv","Global","game","player_direction","onClickFire","player","onFire","onClickBtn","console","log","event","pos","getLocation","jPos","convertToNodeSpaceAR","len"],"mappings":"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","sourceRoot":"/","sourcesContent":["var TagOfDirection = cc.Enum({\r\n    up : 0,\r\n    right : 1,\r\n    down : 2,\r\n    left : 3,\r\n    no : 4,\r\n})\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        playerNodeSpeed: 100,\r\n        Max_r: 100,\r\n    },\r\n\r\n    onLoad() {\r\n\r\n        // 获取摇杆节点并初始化摇杆节点位置及角度\r\n        this.rockerBg = this.node.getChildByName('rockerBg')\r\n        this.joystick = this.node.getChildByName('joystick')\r\n        this.joystick.setPosition(cc.v2(0, 0));\r\n        this.dir = cc.v2(0, 0);\r\n\r\n        // 注册父节点的 touch 监听事件\r\n        this.node.parent.on(cc.Node.EventType.TOUCH_START, this.cbTouchStart, this);\r\n        this.node.parent.on(cc.Node.EventType.TOUCH_MOVE, this.cbTouchMove, this);\r\n        this.node.parent.on(cc.Node.EventType.TOUCH_END, this.cbTouchEnd, this);\r\n        this.node.parent.on(cc.Node.EventType.TOUCH_CANCEL, this.cbTouchCancel, this);\r\n\r\n        // this.node.position = cc.v2(0,0)\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.dir.mag() < 0.5) {\r\n            return;\r\n        }\r\n\r\n        // let vx = this.dir.x * this.playerNodeSpeed;\r\n        // let vy = this.dir.y * this.playerNodeSpeed;\r\n\r\n        // let sx = vx * dt;\r\n        // let sy = vy * dt;\r\n        // //移动\r\n        // // this.playerNode.x += sx;\r\n        // // this.playerNode.y += sy;\r\n\r\n\r\n        //方向计算\r\n        var r = Math.atan2(this.dir.y, this.dir.x);\r\n        var degree = r * 180 / (Math.PI);\r\n        // degree = 360 - degree + 90;\r\n        // this.playerNode.rotation = degree;\r\n        // console.log(degree,111)\r\n       \r\n        // 0正右 90正上 180正左 -90正下\r\n        // 右\r\n        // if (degree >= -45 && degree < 45){\r\n        if (degree >= -30 && degree < 30){\r\n            // console.log('右')\r\n            cc.vv.Global.game.player_direction = TagOfDirection.right\r\n        }\r\n         // 前\r\n        // else if (degree >= 45 && degree < 135){\r\n        else if (degree >= 60 && degree < 120){\r\n            // console.log('前')\r\n            cc.vv.Global.game.player_direction = TagOfDirection.up\r\n        }\r\n        // 左\r\n        // else if ((degree >= 135 && degree <180) || (degree >= -180 && degree < -135)){\r\n        else if ((degree >= 150 && degree <180) || (degree >= -180 && degree < -150)){\r\n            // console.log('左')\r\n            cc.vv.Global.game.player_direction = TagOfDirection.left\r\n        }\r\n        // 下\r\n        // else if (degree >= -135 && degree < -45){\r\n        else if (degree >= -120 && degree < -60){\r\n            // console.log('下')\r\n            cc.vv.Global.game.player_direction = TagOfDirection.down\r\n        }\r\n    },\r\n\r\n    onClickFire(){\r\n        if ( cc.vv.Global.game.player){\r\n            cc.vv.Global.game.player.onFire()\r\n        }\r\n    },\r\n\r\n    onClickBtn(){\r\n        console.log(11111)\r\n    },\r\n\r\n    cbTouchStart(event) {\r\n        let pos = event.getLocation();\r\n        \r\n        // 初始化摇杆节点位置及角度\r\n        this.joystick.setPosition(cc.v2(0, 0));\r\n        this.dir = cc.v2(0, 0);\r\n    },\r\n\r\n    cbTouchMove(event) {\r\n        var pos = event.getLocation();\r\n\r\n        var jPos = this.node.convertToNodeSpaceAR(pos);    // 将世界坐标转化为摇杆组件节点的相对坐标\r\n\r\n        // 获取摇杆的角度\r\n        let len = jPos.mag();\r\n        this.dir.x = jPos.x / len;\r\n        this.dir.y = jPos.y / len;\r\n\r\n        // 设置摇杆的位置\r\n        if (len > this.Max_r) {\r\n            jPos.x = this.Max_r * jPos.x / len;\r\n            jPos.y = this.Max_r * jPos.y / len;\r\n        }\r\n        this.joystick.setPosition(jPos);\r\n    },\r\n\r\n    cbTouchEnd(event) {\r\n        // 初始化摇杆节点位置及角度\r\n        this.joystick.setPosition(cc.v2(0, 0));\r\n        this.dir = cc.v2(0, 0);\r\n        //this.node.active = false;\r\n        console.log('end')\r\n        cc.vv.Global.game.player_direction = TagOfDirection.no\r\n    },\r\n\r\n    cbTouchCancel(event) {\r\n        // 初始化摇杆节点位置及角度\r\n        this.joystick.setPosition(cc.v2(0, 0));\r\n        this.dir = cc.v2(0, 0);\r\n        //this.node.active = false;\r\n        console.log('cancel')\r\n        cc.vv.Global.game.player_direction = TagOfDirection.no\r\n    }\r\n});\r\n"]}