
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/game/bullet.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b97a6rOkmFBtYvPGEX5Zbg2', 'bullet');
// Script/game/bullet.js

"use strict";

// Learn cc.Class:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html

var TagOfDirection = cc.Enum({
  up: 0,
  right: 1,
  down: 2,
  left: 3
});
cc.Class({
  "extends": cc.Component,
  properties: {
    // foo: {
    //     // ATTRIBUTES:
    //     default: null,        // The default value will be used only when the component attaching
    //                           // to a node for the first time
    //     type: cc.SpriteFrame, // optional, default is typeof default
    //     serializable: true,   // optional, default is true
    // },
    // bar: {
    //     get () {
    //         return this._bar;
    //     },
    //     set (value) {
    //         this._bar = value;
    //     }
    // },
  },
  // LIFE-CYCLE CALLBACKS:
  // onLoad () {},
  start: function start() {
    this.collision_tuwall = false;
    this.collision_wall = false;
    this.collision_tank = false;
  },
  init: function init(data) {
    this.data = data;
    this.is_enemy = this.data.is_enemy;
    this.is_shield = false;
    this.is_destroy = false;
  },
  moveUp: function moveUp() {
    this.node.angle = -90 * TagOfDirection.up;
    var speed = this.data.speed;
    this.node.y += speed;
    if (this.node.y >= 728) {
      this.collision_wall = true;
      this.node.destroy();
    }
  },
  moveLeft: function moveLeft() {
    this.node.angle = -90 * TagOfDirection.left;
    var speed = this.data.speed;
    this.node.x -= speed;
    if (this.node.x <= 0) {
      this.collision_wall = true;
      this.node.destroy();
    }
  },
  moveDown: function moveDown() {
    this.node.angle = -90 * TagOfDirection.down;
    var speed = this.data.speed;
    this.node.y -= speed;
    if (this.node.y <= 0) {
      this.collision_wall = true;
      this.node.destroy();
    }
  },
  moveRight: function moveRight() {
    this.node.angle = -90 * TagOfDirection.right;
    var speed = this.data.speed;
    this.node.x += speed;
    if (this.node.x >= 728) {
      this.collision_wall = true;
      this.node.destroy();
    }
  },
  update: function update(dt) {
    var direction = this.data.direction;
    var map = this.data.map;
    if (!map) return;
    var is_enemy = this.data.is_enemy;
    this.is_enemy = is_enemy;
    var pos = this.node.position;
    // let leftPos1 = pos.add(cc.v2(-4,0))
    // let leftPos2 = pos.add(cc.v2(-4-8,0))
    // let rightPos1 = pos.add(cc.v2(4,0))
    // let rightPos2 = pos.add(cc.v2(4+8,0))
    // let upPos1 = pos.add(cc.v2(0, 4))
    // let upPos2 = pos.add(cc.v2(0, 4+8))
    // let downPos1 = pos.add(cc.v2(0,-4))
    // let downPos2 = pos.add(cc.v2(0,-4-8))

    var leftPos1 = pos.add(cc.v2(-7, 0));
    var leftPos2 = pos.add(cc.v2(-7 - 14, 0));
    var rightPos1 = pos.add(cc.v2(7, 0));
    var rightPos2 = pos.add(cc.v2(7 + 14, 0));
    var upPos1 = pos.add(cc.v2(0, 7));
    var upPos2 = pos.add(cc.v2(0, 7 + 14));
    var downPos1 = pos.add(cc.v2(0, -7));
    var downPos2 = pos.add(cc.v2(0, -7 - 14));
    var pos_arr = [];
    if (direction == TagOfDirection.up) {
      this.moveUp();
      pos_arr = [leftPos1, leftPos2, rightPos1, rightPos2];
    } else if (direction == TagOfDirection.left) {
      this.moveLeft();
      pos_arr = [upPos1, upPos2, downPos1, downPos2];
    } else if (direction == TagOfDirection.down) {
      this.moveDown();
      pos_arr = [leftPos1, leftPos2, rightPos1, rightPos2];
    } else if (direction == TagOfDirection.right) {
      this.moveRight();
      pos_arr = [upPos1, upPos2, downPos1, downPos2];
    }
    // 检查子弹之间的碰撞
    var p_arr = [].concat(pos_arr);
    p_arr.push(pos);
    for (var i = 0; i < p_arr.length; i++) {
      var bullet = map.collisionBullet(p_arr[i], is_enemy);
      if (bullet) {
        bullet.destroy();
        this.node.destroy();
        return;
      }
    }
    // 检查子弹和坦克之间的碰撞
    for (var _i = 0; _i < pos_arr.length; _i++) {
      // 敌人
      if (is_enemy) {
        var tank = map.collisionBulletAndPlayerTanks(pos_arr[_i]);
        if (tank) {
          this.is_shield = tank.is_shield;
          if (!tank.is_shield) {
            tank.node.destroy();
            this.collision_tank = true;
          }
          this.node.destroy();
          return;
        }
      }
      // 玩家
      else {
        var _tank = map.collisionBulletAndEnemyTanks(pos_arr[_i]);
        if (_tank) {
          console.log(_tank.is_shield, 11111);
          if (!_tank.is_shield) {
            _tank.live--;
            if (_tank.live <= 0) {
              var tank_level = _tank.tank_level;
              cc.vv.Global.die_tank['tank_' + tank_level]++;
              this.collision_tank = true;
              _tank.node.destroy();
            } else {
              this.collision_wall = true;
            }
            if (_tank.tank_hong) {
              console.log('红坦克');
              map.initProps();
            }
            this.node.destroy();
            return;
          }
        }
      }
    }
    // let pos_arr = [/*leftPos1, leftPos2, rightPos1, rightPos2,*/ upPos1, upPos2, downPos1, downPos2]
    for (var _i2 = 0; _i2 < pos_arr.length; _i2++) {
      var tid = map.getTiledIdFromPos(pos_arr[_i2]);
      this.node.zIndex = -1;
      if (tid > 0) {
        if (cc.vv.Global.isGrassland(tid)) {
          // console.log('草地')
        } else if (cc.vv.Global.isGoldWall(tid)) {
          // console.log('金砖')
          this.collision_wall = true;
          this.node.destroy();
          return;
        } else if (cc.vv.Global.isRiver(tid)) {
          // console.log('河')
          this.node.zIndex = this.node.parent.childrenCount;
        } else if (cc.vv.Global.isHome(tid)) {
          console.log('家被打，游戏结束');
          map.bg3.node.active = true;
          this.is_destroy = true;
          cc.vv.Global.game.is_over = true;
        } else {
          // console.log(tid,i)
          this.is_destroy = true;
          var gid_pos = map.getTiledCoordinate(pos_arr[_i2]);
          map.bg1.setTileGIDAt(0, gid_pos.x, gid_pos.y, 0);
        }
      }
    }
    if (this.is_destroy) {
      this.collision_tuwall = true;
      this.node.destroy();
    }
  },
  onDestroy: function onDestroy() {
    if (!this.is_shield) {
      var fire_flower = cc.instantiate(cc.vv.Global.game.fire_flower_prefab);
      fire_flower.position = this.node.position;
      this.node.parent.addChild(fire_flower);
      var data = {
        level: 1,
        is_enemy: this.is_enemy,
        collision_tuwall: this.collision_tuwall,
        collision_wall: this.collision_wall,
        collision_tank: this.collision_tank
      };
      fire_flower.getComponent('fire_flower').init(data);
    }
    this.data.destroy();
    // console.log('bullet destroy')
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxnYW1lXFxidWxsZXQuanMiXSwibmFtZXMiOlsiVGFnT2ZEaXJlY3Rpb24iLCJjYyIsIkVudW0iLCJ1cCIsInJpZ2h0IiwiZG93biIsImxlZnQiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJzdGFydCIsImNvbGxpc2lvbl90dXdhbGwiLCJjb2xsaXNpb25fd2FsbCIsImNvbGxpc2lvbl90YW5rIiwiaW5pdCIsImRhdGEiLCJpc19lbmVteSIsImlzX3NoaWVsZCIsImlzX2Rlc3Ryb3kiLCJtb3ZlVXAiLCJub2RlIiwiYW5nbGUiLCJzcGVlZCIsInkiLCJkZXN0cm95IiwibW92ZUxlZnQiLCJ4IiwibW92ZURvd24iLCJtb3ZlUmlnaHQiLCJ1cGRhdGUiLCJkdCIsImRpcmVjdGlvbiIsIm1hcCIsInBvcyIsInBvc2l0aW9uIiwibGVmdFBvczEiLCJhZGQiLCJ2MiIsImxlZnRQb3MyIiwicmlnaHRQb3MxIiwicmlnaHRQb3MyIiwidXBQb3MxIiwidXBQb3MyIiwiZG93blBvczEiLCJkb3duUG9zMiIsInBvc19hcnIiLCJwX2FyciIsImNvbmNhdCIsInB1c2giLCJpIiwibGVuZ3RoIiwiYnVsbGV0IiwiY29sbGlzaW9uQnVsbGV0IiwidGFuayIsImNvbGxpc2lvbkJ1bGxldEFuZFBsYXllclRhbmtzIiwiY29sbGlzaW9uQnVsbGV0QW5kRW5lbXlUYW5rcyIsImNvbnNvbGUiLCJsb2ciLCJsaXZlIiwidGFua19sZXZlbCIsInZ2IiwiR2xvYmFsIiwiZGllX3RhbmsiLCJ0YW5rX2hvbmciLCJpbml0UHJvcHMiLCJ0aWQiLCJnZXRUaWxlZElkRnJvbVBvcyIsInpJbmRleCIsImlzR3Jhc3NsYW5kIiwiaXNHb2xkV2FsbCIsImlzUml2ZXIiLCJwYXJlbnQiLCJjaGlsZHJlbkNvdW50IiwiaXNIb21lIiwiYmczIiwiYWN0aXZlIiwiZ2FtZSIsImlzX292ZXIiLCJnaWRfcG9zIiwiZ2V0VGlsZWRDb29yZGluYXRlIiwiYmcxIiwic2V0VGlsZUdJREF0Iiwib25EZXN0cm95IiwiZmlyZV9mbG93ZXIiLCJpbnN0YW50aWF0ZSIsImZpcmVfZmxvd2VyX3ByZWZhYiIsImFkZENoaWxkIiwibGV2ZWwiLCJnZXRDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLElBQUlBLGNBQWMsR0FBR0MsRUFBRSxDQUFDQyxJQUFJLENBQUM7RUFDekJDLEVBQUUsRUFBRyxDQUFDO0VBQ05DLEtBQUssRUFBRyxDQUFDO0VBQ1RDLElBQUksRUFBRyxDQUFDO0VBQ1JDLElBQUksRUFBRztBQUNYLENBQUMsQ0FBQztBQUVGTCxFQUFFLENBQUNNLEtBQUssQ0FBQztFQUNMLFdBQVNOLEVBQUUsQ0FBQ08sU0FBUztFQUVyQkMsVUFBVSxFQUFFO0lBQ1I7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0VBQUEsQ0FDSDtFQUVEO0VBRUE7RUFFQUMsS0FBSyxXQUFBQSxNQUFBLEVBQUk7SUFDTCxJQUFJLENBQUNDLGdCQUFnQixHQUFHLEtBQUs7SUFDN0IsSUFBSSxDQUFDQyxjQUFjLEdBQUcsS0FBSztJQUMzQixJQUFJLENBQUNDLGNBQWMsR0FBRyxLQUFLO0VBQy9CLENBQUM7RUFFREMsSUFBSSxXQUFBQSxLQUFDQyxJQUFJLEVBQUM7SUFDTixJQUFJLENBQUNBLElBQUksR0FBR0EsSUFBSTtJQUNoQixJQUFJLENBQUNDLFFBQVEsR0FBRyxJQUFJLENBQUNELElBQUksQ0FBQ0MsUUFBUTtJQUVsQyxJQUFJLENBQUNDLFNBQVMsR0FBRyxLQUFLO0lBQ3RCLElBQUksQ0FBQ0MsVUFBVSxHQUFHLEtBQUs7RUFHM0IsQ0FBQztFQUVEQyxNQUFNLFdBQUFBLE9BQUEsRUFBRTtJQUNKLElBQUksQ0FBQ0MsSUFBSSxDQUFDQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLEdBQUdy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QVksQ0FBQyxhQUFhLENBQUMsQ0FBQzFFLElBQUksQ0FBQ0MsSUFBSSxDQUFDO0lBQ3REO0lBQ0EsSUFBSSxDQUFDQSxJQUFJLENBQUNTLE9BQU8sRUFBRTtJQUNuQjtFQUNKO0FBQ0osQ0FBQyxDQUFDIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMZWFybiBjYy5DbGFzczpcclxuLy8gIC0gW0NoaW5lc2VdIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL2NsYXNzLmh0bWxcclxuLy8gIC0gW0VuZ2xpc2hdIGh0dHA6Ly9kb2NzLmNvY29zMmQteC5vcmcvY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL2NsYXNzLmh0bWxcclxuLy8gTGVhcm4gQXR0cmlidXRlOlxyXG4vLyAgLSBbQ2hpbmVzZV0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC96aC9zY3JpcHRpbmcvcmVmZXJlbmNlL2F0dHJpYnV0ZXMuaHRtbFxyXG4vLyAgLSBbRW5nbGlzaF0gaHR0cDovL2RvY3MuY29jb3MyZC14Lm9yZy9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvcmVmZXJlbmNlL2F0dHJpYnV0ZXMuaHRtbFxyXG4vLyBMZWFybiBsaWZlLWN5Y2xlIGNhbGxiYWNrczpcclxuLy8gIC0gW0NoaW5lc2VdIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL2xpZmUtY3ljbGUtY2FsbGJhY2tzLmh0bWxcclxuLy8gIC0gW0VuZ2xpc2hdIGh0dHBzOi8vd3d3LmNvY29zMmQteC5vcmcvZG9jcy9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvbGlmZS1jeWNsZS1jYWxsYmFja3MuaHRtbFxyXG5cclxudmFyIFRhZ09mRGlyZWN0aW9uID0gY2MuRW51bSh7XHJcbiAgICB1cCA6IDAsXHJcbiAgICByaWdodCA6IDEsXHJcbiAgICBkb3duIDogMixcclxuICAgIGxlZnQgOiAzLFxyXG59KVxyXG5cclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICAvLyBmb286IHtcclxuICAgICAgICAvLyAgICAgLy8gQVRUUklCVVRFUzpcclxuICAgICAgICAvLyAgICAgZGVmYXVsdDogbnVsbCwgICAgICAgIC8vIFRoZSBkZWZhdWx0IHZhbHVlIHdpbGwgYmUgdXNlZCBvbmx5IHdoZW4gdGhlIGNvbXBvbmVudCBhdHRhY2hpbmdcclxuICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRvIGEgbm9kZSBmb3IgdGhlIGZpcnN0IHRpbWVcclxuICAgICAgICAvLyAgICAgdHlwZTogY2MuU3ByaXRlRnJhbWUsIC8vIG9wdGlvbmFsLCBkZWZhdWx0IGlzIHR5cGVvZiBkZWZhdWx0XHJcbiAgICAgICAgLy8gICAgIHNlcmlhbGl6YWJsZTogdHJ1ZSwgICAvLyBvcHRpb25hbCwgZGVmYXVsdCBpcyB0cnVlXHJcbiAgICAgICAgLy8gfSxcclxuICAgICAgICAvLyBiYXI6IHtcclxuICAgICAgICAvLyAgICAgZ2V0ICgpIHtcclxuICAgICAgICAvLyAgICAgICAgIHJldHVybiB0aGlzLl9iYXI7XHJcbiAgICAgICAgLy8gICAgIH0sXHJcbiAgICAgICAgLy8gICAgIHNldCAodmFsdWUpIHtcclxuICAgICAgICAvLyAgICAgICAgIHRoaXMuX2JhciA9IHZhbHVlO1xyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gfSxcclxuICAgIH0sXHJcblxyXG4gICAgLy8gTElGRS1DWUNMRSBDQUxMQkFDS1M6XHJcblxyXG4gICAgLy8gb25Mb2FkICgpIHt9LFxyXG5cclxuICAgIHN0YXJ0ICgpIHtcclxuICAgICAgICB0aGlzLmNvbGxpc2lvbl90dXdhbGwgPSBmYWxzZVxyXG4gICAgICAgIHRoaXMuY29sbGlzaW9uX3dhbGwgPSBmYWxzZVxyXG4gICAgICAgIHRoaXMuY29sbGlzaW9uX3RhbmsgPSBmYWxzZVxyXG4gICAgfSxcclxuXHJcbiAgICBpbml0KGRhdGEpe1xyXG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGFcclxuICAgICAgICB0aGlzLmlzX2VuZW15ID0gdGhpcy5kYXRhLmlzX2VuZW15XHJcbiAgICAgICBcclxuICAgICAgICB0aGlzLmlzX3NoaWVsZCA9IGZhbHNlXHJcbiAgICAgICAgdGhpcy5pc19kZXN0cm95ID0gZmFsc2VcclxuXHJcbiAgICAgIFxyXG4gICAgfSxcclxuXHJcbiAgICBtb3ZlVXAoKXtcclxuICAgICAgICB0aGlzLm5vZGUuYW5nbGUgPSAtOTAgKiBUYWdPZkRpcmVjdGlvbi51cFxyXG4gICAgICAgIGxldCBzcGVlZCA9IHRoaXMuZGF0YS5zcGVlZFxyXG4gICAgICAgIHRoaXMubm9kZS55ICs9IHNwZWVkXHJcbiAgICAgICAgaWYgKHRoaXMubm9kZS55ID49IDcyOCl7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uX3dhbGwgPSB0cnVlXHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5kZXN0cm95KClcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIG1vdmVMZWZ0KCl7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gLTkwICogVGFnT2ZEaXJlY3Rpb24ubGVmdFxyXG4gICAgICAgIGxldCBzcGVlZCA9IHRoaXMuZGF0YS5zcGVlZFxyXG4gICAgICAgIHRoaXMubm9kZS54IC09IHNwZWVkXHJcbiAgICAgICAgaWYgKHRoaXMubm9kZS54IDw9IDApe1xyXG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvbl93YWxsID0gdHJ1ZVxyXG4gICAgICAgICAgICB0aGlzLm5vZGUuZGVzdHJveSgpXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBtb3ZlRG93bigpe1xyXG4gICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IC05MCAqIFRhZ09mRGlyZWN0aW9uLmRvd25cclxuICAgICAgICBsZXQgc3BlZWQgPSB0aGlzLmRhdGEuc3BlZWRcclxuICAgICAgICB0aGlzLm5vZGUueSAtPSBzcGVlZFxyXG4gICAgICAgIGlmICh0aGlzLm5vZGUueSA8PSAwKXtcclxuICAgICAgICAgICAgdGhpcy5jb2xsaXNpb25fd2FsbCA9IHRydWVcclxuICAgICAgICAgICAgdGhpcy5ub2RlLmRlc3Ryb3koKVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgbW92ZVJpZ2h0KCl7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gLTkwICogVGFnT2ZEaXJlY3Rpb24ucmlnaHRcclxuICAgICAgICBsZXQgc3BlZWQgPSB0aGlzLmRhdGEuc3BlZWRcclxuICAgICAgICB0aGlzLm5vZGUueCArPSBzcGVlZFxyXG4gICAgICAgIGlmICh0aGlzLm5vZGUueCA+PSA3Mjgpe1xyXG4gICAgICAgICAgICB0aGlzLmNvbGxpc2lvbl93YWxsID0gdHJ1ZVxyXG4gICAgICAgICAgICB0aGlzLm5vZGUuZGVzdHJveSgpXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICB1cGRhdGUgKGR0KSB7XHJcbiAgICAgICAgbGV0IGRpcmVjdGlvbiA9IHRoaXMuZGF0YS5kaXJlY3Rpb25cclxuICAgICAgICBsZXQgbWFwID0gdGhpcy5kYXRhLm1hcFxyXG4gICAgICAgIGlmICghbWFwKSByZXR1cm5cclxuICAgICAgICBsZXQgaXNfZW5lbXkgPSB0aGlzLmRhdGEuaXNfZW5lbXlcclxuICAgICAgICB0aGlzLmlzX2VuZW15ID0gaXNfZW5lbXlcclxuICAgICAgICBsZXQgcG9zID0gdGhpcy5ub2RlLnBvc2l0aW9uXHJcbiAgICAgICAgLy8gbGV0IGxlZnRQb3MxID0gcG9zLmFkZChjYy52MigtNCwwKSlcclxuICAgICAgICAvLyBsZXQgbGVmdFBvczIgPSBwb3MuYWRkKGNjLnYyKC00LTgsMCkpXHJcbiAgICAgICAgLy8gbGV0IHJpZ2h0UG9zMSA9IHBvcy5hZGQoY2MudjIoNCwwKSlcclxuICAgICAgICAvLyBsZXQgcmlnaHRQb3MyID0gcG9zLmFkZChjYy52Mig0KzgsMCkpXHJcbiAgICAgICAgLy8gbGV0IHVwUG9zMSA9IHBvcy5hZGQoY2MudjIoMCwgNCkpXHJcbiAgICAgICAgLy8gbGV0IHVwUG9zMiA9IHBvcy5hZGQoY2MudjIoMCwgNCs4KSlcclxuICAgICAgICAvLyBsZXQgZG93blBvczEgPSBwb3MuYWRkKGNjLnYyKDAsLTQpKVxyXG4gICAgICAgIC8vIGxldCBkb3duUG9zMiA9IHBvcy5hZGQoY2MudjIoMCwtNC04KSlcclxuXHJcbiAgICAgICAgbGV0IGxlZnRQb3MxID0gcG9zLmFkZChjYy52MigtNywwKSlcclxuICAgICAgICBsZXQgbGVmdFBvczIgPSBwb3MuYWRkKGNjLnYyKC03LTE0LDApKVxyXG4gICAgICAgIGxldCByaWdodFBvczEgPSBwb3MuYWRkKGNjLnYyKDcsMCkpXHJcbiAgICAgICAgbGV0IHJpZ2h0UG9zMiA9IHBvcy5hZGQoY2MudjIoNysxNCwwKSlcclxuICAgICAgICBsZXQgdXBQb3MxID0gcG9zLmFkZChjYy52MigwLCA3KSlcclxuICAgICAgICBsZXQgdXBQb3MyID0gcG9zLmFkZChjYy52MigwLCA3KzE0KSlcclxuICAgICAgICBsZXQgZG93blBvczEgPSBwb3MuYWRkKGNjLnYyKDAsLTcpKVxyXG4gICAgICAgIGxldCBkb3duUG9zMiA9IHBvcy5hZGQoY2MudjIoMCwtNy0xNCkpXHJcblxyXG4gICAgICAgIGxldCBwb3NfYXJyID0gW11cclxuICAgICAgICBpZiAoZGlyZWN0aW9uID09IFRhZ09mRGlyZWN0aW9uLnVwKXtcclxuICAgICAgICAgICAgdGhpcy5tb3ZlVXAoKTtcclxuICAgICAgICAgICAgcG9zX2FyciA9IFtsZWZ0UG9zMSwgbGVmdFBvczIsIHJpZ2h0UG9zMSwgcmlnaHRQb3MyXVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChkaXJlY3Rpb24gPT0gVGFnT2ZEaXJlY3Rpb24ubGVmdCl7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZUxlZnQoKTtcclxuICAgICAgICAgICAgcG9zX2FyciA9IFt1cFBvczEsIHVwUG9zMiwgZG93blBvczEsIGRvd25Qb3MyXVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChkaXJlY3Rpb24gPT0gVGFnT2ZEaXJlY3Rpb24uZG93bil7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZURvd24oKTtcclxuICAgICAgICAgICAgcG9zX2FyciA9IFtsZWZ0UG9zMSwgbGVmdFBvczIsIHJpZ2h0UG9zMSwgcmlnaHRQb3MyXVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChkaXJlY3Rpb24gPT0gVGFnT2ZEaXJlY3Rpb24ucmlnaHQpe1xyXG4gICAgICAgICAgICB0aGlzLm1vdmVSaWdodCgpO1xyXG4gICAgICAgICAgICBwb3NfYXJyID0gW3VwUG9zMSwgdXBQb3MyLCBkb3duUG9zMSwgZG93blBvczJdXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOajgOafpeWtkOW8ueS5i+mXtOeahOeisOaSnlxyXG4gICAgICAgIGxldCBwX2FyciA9IFsuLi5wb3NfYXJyXVxyXG4gICAgICAgIHBfYXJyLnB1c2gocG9zKVxyXG4gICAgICAgIGZvciAobGV0IGk9MDtpPHBfYXJyLmxlbmd0aDtpKyspe1xyXG4gICAgICAgICAgICBsZXQgYnVsbGV0ID0gbWFwLmNvbGxpc2lvbkJ1bGxldChwX2FycltpXSwgaXNfZW5lbXkpXHJcbiAgICAgICAgICAgIGlmIChidWxsZXQpe1xyXG4gICAgICAgICAgICAgICAgYnVsbGV0LmRlc3Ryb3koKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLmRlc3Ryb3koKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5qOA5p+l5a2Q5by55ZKM5Z2m5YWL5LmL6Ze055qE56Kw5pKeXHJcbiAgICAgICAgZm9yIChsZXQgaT0wO2k8cG9zX2Fyci5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgLy8g5pWM5Lq6XHJcbiAgICAgICAgICAgIGlmIChpc19lbmVteSl7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGFuayA9IG1hcC5jb2xsaXNpb25CdWxsZXRBbmRQbGF5ZXJUYW5rcyhwb3NfYXJyW2ldKVxyXG4gICAgICAgICAgICAgICAgaWYgKHRhbmspe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNfc2hpZWxkID0gdGFuay5pc19zaGllbGRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRhbmsuaXNfc2hpZWxkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhbmsubm9kZS5kZXN0cm95KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb2xsaXNpb25fdGFuayA9IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub2RlLmRlc3Ryb3koKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOeOqeWutlxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCB0YW5rID0gbWFwLmNvbGxpc2lvbkJ1bGxldEFuZEVuZW15VGFua3MocG9zX2FycltpXSlcclxuICAgICAgICAgICAgICAgIGlmICh0YW5rKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0YW5rLmlzX3NoaWVsZCwxMTExMSlcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRhbmsuaXNfc2hpZWxkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFuay5saXZlLS1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhbmsubGl2ZSA8PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0YW5rX2xldmVsID0gdGFuay50YW5rX2xldmVsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy52di5HbG9iYWwuZGllX3RhbmtbJ3RhbmtfJyt0YW5rX2xldmVsXSsrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29sbGlzaW9uX3RhbmsgPSB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YW5rLm5vZGUuZGVzdHJveSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxpc2lvbl93YWxsID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YW5rLnRhbmtfaG9uZyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn57qi5Z2m5YWLJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5pbml0UHJvcHMoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS5kZXN0cm95KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGxldCBwb3NfYXJyID0gWy8qbGVmdFBvczEsIGxlZnRQb3MyLCByaWdodFBvczEsIHJpZ2h0UG9zMiwqLyB1cFBvczEsIHVwUG9zMiwgZG93blBvczEsIGRvd25Qb3MyXVxyXG4gICAgICAgIGZvciAobGV0IGk9MDtpPHBvc19hcnIubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgIGxldCB0aWQgPSBtYXAuZ2V0VGlsZWRJZEZyb21Qb3MocG9zX2FycltpXSlcclxuICAgICAgICAgICAgdGhpcy5ub2RlLnpJbmRleCA9IC0xXHJcbiAgICAgICAgICAgIGlmICh0aWQgPiAwKXtcclxuICAgICAgICAgICAgICAgIGlmIChjYy52di5HbG9iYWwuaXNHcmFzc2xhbmQodGlkKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ+iNieWcsCcpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjYy52di5HbG9iYWwuaXNHb2xkV2FsbCh0aWQpKXtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygn6YeR56CWJylcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbGxpc2lvbl93YWxsID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS5kZXN0cm95KClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNjLnZ2Lkdsb2JhbC5pc1JpdmVyKHRpZCkpe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCfmsrMnKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZS56SW5kZXggPSB0aGlzLm5vZGUucGFyZW50LmNoaWxkcmVuQ291bnRcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNjLnZ2Lkdsb2JhbC5pc0hvbWUodGlkKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+Wutuiiq+aJk++8jOa4uOaIj+e7k+adnycpXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwLmJnMy5ub2RlLmFjdGl2ZSA9IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzX2Rlc3Ryb3kgPSB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgY2MudnYuR2xvYmFsLmdhbWUuaXNfb3ZlciA9IHRydWVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRpZCxpKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXNfZGVzdHJveSA9IHRydWVcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZ2lkX3BvcyA9IG1hcC5nZXRUaWxlZENvb3JkaW5hdGUocG9zX2FycltpXSlcclxuICAgICAgICAgICAgICAgICAgICBtYXAuYmcxLnNldFRpbGVHSURBdCgwLCBnaWRfcG9zLngsIGdpZF9wb3MueSwgMClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pc19kZXN0cm95KXtcclxuICAgICAgICAgICAgdGhpcy5jb2xsaXNpb25fdHV3YWxsID0gdHJ1ZVxyXG4gICAgICAgICAgICB0aGlzLm5vZGUuZGVzdHJveSgpXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBvbkRlc3Ryb3kgKCl7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzX3NoaWVsZCl7XHJcbiAgICAgICAgICAgIGxldCBmaXJlX2Zsb3dlciA9IGNjLmluc3RhbnRpYXRlKGNjLnZ2Lkdsb2JhbC5nYW1lLmZpcmVfZmxvd2VyX3ByZWZhYilcclxuICAgICAgICAgICAgZmlyZV9mbG93ZXIucG9zaXRpb24gPSB0aGlzLm5vZGUucG9zaXRpb25cclxuICAgICAgICAgICAgdGhpcy5ub2RlLnBhcmVudC5hZGRDaGlsZChmaXJlX2Zsb3dlcilcclxuXHJcbiAgICAgICAgICAgIGxldCBkYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgbGV2ZWwgOiAxLFxyXG4gICAgICAgICAgICAgICAgaXNfZW5lbXkgOiB0aGlzLmlzX2VuZW15LFxyXG4gICAgICAgICAgICAgICAgY29sbGlzaW9uX3R1d2FsbCA6IHRoaXMuY29sbGlzaW9uX3R1d2FsbCxcclxuICAgICAgICAgICAgICAgIGNvbGxpc2lvbl93YWxsIDogdGhpcy5jb2xsaXNpb25fd2FsbCxcclxuICAgICAgICAgICAgICAgIGNvbGxpc2lvbl90YW5rICA6IHRoaXMuY29sbGlzaW9uX3RhbmssXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZmlyZV9mbG93ZXIuZ2V0Q29tcG9uZW50KCdmaXJlX2Zsb3dlcicpLmluaXQoZGF0YSlcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kYXRhLmRlc3Ryb3koKVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdidWxsZXQgZGVzdHJveScpXHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=